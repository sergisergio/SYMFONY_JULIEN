{% extends "bundle.html.twig" %}

{% block lang %}fr{% endblock %}

{% block title %}Movie | Update{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="/libs/jquery-ui/css/jquery-ui.css">
{% endblock %}

{% block main %}

    <div class="container py-5">
        <div class="row">
            <div class="col">

                <h1 class="border-bottom mb-5 pb-3">Movie Update</h1>
                
                <button type="button" class="btn btn-sm btn-secondary" onclick="javascript:window.open('{{ path('movie_show', {'id': movie.id}) }}','_self');">Back to Show</button>

                <h2 class="my-3">Movie #{{ movie.id }}</h2>
                
                <form action="" method="post">
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" class="form-control form-control-sm" id="title" name="title" value="{{ movie.title }}">
                    </div>
                    <div class="form-group">
                        <label for="date">Date</label>
                        <input type="text" class="form-control form-control-sm datepicker" id="date" name="date" value="{{ movie.date|date('Y-m-d') }}" readonly>
                    </div>
                    <div class="form-group">
                        <label for="director">Director</label>
                        <input type="text" class="form-control form-control-sm" id="director" name="director" value="{{ movie.director }}">
                    </div>
                    <div class="form-group">
                        <label for="cast[]">Cast</label>
                        <div class="card mb-3">
                            <div class="card-body">
                                {% for cast in movie.cast %}
                                <div class="row" id="cast_{{ loop.index }}">
                                    <div class="col"><input type="text" class="form-control form-control-sm mb-1" name="cast[]" value="{{ cast }}"></div>
                                    <div class="col"><button type="button" class="btn btn-sm btn-danger" data-delete="cast_{{ loop.index }}">Remove</button></div>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="card-footer">
                                <button type="button" class="btn btn-sm btn-primary">Add a new cast</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-sm btn-success">Save</button>
                    </div>
                </form>
            
            </div>
        </div>
    </div>
    
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="/libs/jquery/jquery-1.12.4.js"></script>
<script src="/libs/jquery-ui/js/jquery-ui.js"></script>
<script type="text/javascript">
var nb_cast = {{ movie.cast|length }};
$(function(){
    $(".datepicker").datepicker({
        dateFormat: "yy-mm-dd"
    });
    $(".btn-danger").click(function(){
        var id = $(this).attr('data-delete');
        $("#" + id).remove();
    });
    $(".btn-primary").click(function(){
        var add = nb_cast + 1;
        var html  = "<div class=\"row\" id=\"cast_" + (++nb_cast) + "\">";
            html +=     "<div class=\"col\"><input type=\"text\" class=\"form-control form-control-sm mb-1\" name=\"cast[]\"></div>";
            html +=     "<div class=\"col\"><button type=\"button\" class=\"btn btn-sm btn-danger\" data-delete=\"cast_" + (nb_cast) + "\">Remove</button></div>";
            html += "</div>";
        $(".card-body").append(html);
        $(".btn-danger").click(function(){
            var id = $(this).attr('data-delete');
            $("#" + id).remove();
        });
    });
});
</script>
{% endblock %}